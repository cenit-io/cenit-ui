(this.webpackJsonpadmin=this.webpackJsonpadmin||[]).push([[365],{1133:function(e,n,t){"use strict";t.r(n);var r=t(1),a=t(0),c=t(4),o=t(78);function i(e){return Object(r.jsxs)(o.a,Object(c.a)(Object(c.a)({},e),{},{children:[Object(r.jsx)("path",{d:"M23.49,11.15H.51a.51.51,0,0,0-.51.51V20.2a2.31,2.31,0,0,0,2.3,2.3H21.7A2.31,2.31,0,0,0,24,20.2V11.66A.51.51,0,0,0,23.49,11.15Z"}),Object(r.jsx)("path",{d:"M21.7,4.37H18.19V1.89a.75.75,0,0,0-1.5,0V4.37H7.22V1.89a.75.75,0,1,0-1.5,0V4.37H2.3A2.31,2.31,0,0,0,0,6.67V9.14a.51.51,0,0,0,.51.51h23A.51.51,0,0,0,24,9.14V6.67A2.31,2.31,0,0,0,21.7,4.37Z"})]}))}var u=t(8),l=t(14),s=t(93),d=t(16),b=t(92),j=t(143),f=t(312),h=t(206),g=t.n(h),p=t(436),m=t(388),v=t(75),O=t(124),x=t.n(O),C=t(52),y=t(3),_=t(518),k=t(416),A=t.n(k),w=t(1156),S=t(961),N=t(160),E=t(10),H=t(38),I=t(394),B=t(72),V=t.n(B),M={like:"Contains",is:"Is exactly",starts_with:"Starts with",ends_with:"Ends with",_not_null:"Is present",_null:"Is blank",_change:"Changes",_presence_change:"Present & Changes",between:"Is between",today:"Today",yesterday:"Yesterday",this_week:"This week",last_week:"Last week"},D=["_not_null","_null","_change","_presence_change"];function F(e){var n=function(n){return function(){return e.onClick(n)}};return D.map((function(e){return Object(r.jsx)(p.a,{onClick:n(e),children:M[e]},"operation_".concat(e))}))}var T=["like","is","starts_with","ends_with"];function J(e){var n,t=e.value,a=e.disabled,o=e.onChange,i=Object(l.a)({condition:t}),s=Object(u.a)(i,2),d=s[0],b=s[1],h=d.condition,g=d.menuAnchor,m=function(e){b({condition:e,menuAnchor:null}),o(e)},v=T.map((function(e){return Object(r.jsx)(p.a,{onClick:function(){return n=e,m(Object(c.a)(Object(c.a)({},h),{},{o:n}));var n},children:M[e]},"operator_".concat(e))}));return-1!==T.indexOf(h.o)&&(n=Object(r.jsx)(A.a,{value:h.v||"",placeholder:"?",onChange:function(e){var n,t=e.target;return n=t.value,m(Object(c.a)(Object(c.a)({},h),{},{v:n}))},disabled:a})),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(j.a,{onClick:function(e){var n=e.target;return b({menuAnchor:n})},disabled:a,children:M[h.o]}),n,Object(r.jsxs)(f.a,{open:Boolean(g),anchorEl:g,onClose:function(){return b({menuAnchor:null})},children:[v,Object(r.jsx)(_.a,{}),F({onClick:function(e){return m({o:e})}})]})]})}var L=Object(C.a)((function(e){return{root:{"& .MuiAutocomplete-endAdornment":{top:e.spacing(-1)}}}}));function P(e){var n=e.value,t=e.disabled,o=e.onChange,i=e.property,s=Object(l.a)({condition:n,options:[]}),d=Object(u.a)(s,2),b=d[0],h=d[1],g=L(),m=b.condition,v=b.menuAnchor,O=b.options;Object(a.useEffect)((function(){h({options:i.propertySchema.enum.map((function(e){return{name:e}}))})}),[i]);var x,C=function(e){var n={v:e=e.map((function(e){return e.name}))};h({condition:n,menuAnchor:null}),o(n)};if(O.length&&!m.o){var y=[m.v].flat(1);y=O.filter((function(e){var n=e.name;return-1!==y.indexOf(n)})),x=Object(r.jsx)(S.a,{multiple:!0,className:g.root,options:O,getOptionLabel:function(e){return e.name},value:y,filterSelectedOptions:!0,disableClearable:!0,renderInput:function(e){return Object(r.jsx)(N.a,Object(c.a)({},e))},onChange:function(e,n){return C(n)},disabled:t})}return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(j.a,{onClick:function(e){var n=e.target;return h({menuAnchor:n})},disabled:t,children:M[m.o]||"Value is"}),x,Object(r.jsxs)(f.a,{open:Boolean(v),anchorEl:v,onClose:function(){return h({menuAnchor:null})},children:[Object(r.jsx)(p.a,{onClick:function(){return h({condition:{},menuAnchor:null})},children:"Value"}),Object(r.jsx)(_.a,{}),F({onClick:function(e){var n={o:e};h({condition:n,menuAnchor:null,autocomplete:!1}),o(n)}})]})]})}function z(e){var n=e.value,t=e.disabled,a=e.onChange,c=Object(l.a)({condition:n}),o=Object(u.a)(c,2),i=o[0],s=o[1],d=i.condition,b=i.menuAnchor,h=function(e){var n={v:e};s({condition:n,menuAnchor:null}),a(n)};return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(j.a,{onClick:function(e){var n=e.target;return s({menuAnchor:n})},disabled:t,children:M[d.o]||"Is ".concat(d.v)}),Object(r.jsxs)(f.a,{open:Boolean(b),anchorEl:b,onClose:function(){return s({menuAnchor:null})},children:[Object(r.jsx)(p.a,{onClick:function(){return h("true")},children:"True"}),Object(r.jsx)(p.a,{onClick:function(){return h("false")},children:"False"}),Object(r.jsx)(_.a,{}),F({onClick:function(e){var n={o:e};s({condition:n,menuAnchor:null}),a(n)}})]})]})}var R=Object(C.a)((function(e){return{and:{margin:e.spacing(0,1)},disabled:{color:e.palette.text.disabled}}}));function Z(e){var n,t=e.value,a=e.disabled,o=e.onChange,i=Object(l.a)({condition:t}),s=Object(u.a)(i,2),d=s[0],b=s[1],h=R(),g=d.condition,m=d.menuAnchor,v=function(e){b({condition:e,menuAnchor:null}),o(e)},O=function(e){var n=g.v||["","",""];return e.forEach((function(t,r){return e[r]=void 0===t?n[r]:t})),e},x=function(e){return v(Object(c.a)(Object(c.a)({},g),{},{v:O(e)}))},C=function(e,n){return v({o:e,v:O(n)})};return"default"===g.o?n=Object(r.jsx)(A.a,{value:g.v[0]||"",placeholder:"?",onChange:function(e){var n=e.target;return x([n.value,"",""])},disabled:a,type:"number"}):"between"===g.o&&(n=Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(A.a,{value:g.v[1]||"",placeholder:"-\u221e",onChange:function(e){var n=e.target;return x(["",n.value,void 0])},disabled:a,type:"number"}),Object(r.jsx)("span",{className:Object(y.default)(h.and,a&&h.disabled),children:"AND"}),Object(r.jsx)(A.a,{value:g.v[2]||"",placeholder:"\u221e",onChange:function(e){var n=e.target;return x(["",void 0,n.value])},disabled:a,type:"number"})]})),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(j.a,{onClick:function(e){var n=e.target;return b({menuAnchor:n})},disabled:a,children:M[g.o]||"Is number"}),n,Object(r.jsxs)(f.a,{open:Boolean(m),anchorEl:m,onClose:function(){return b({menuAnchor:null})},children:[Object(r.jsx)(p.a,{onClick:function(){return C("default",[void 0,"",""])},children:"Number"}),Object(r.jsx)(p.a,{onClick:function(){return C("between",["",void 0,void 0])},children:"Between"}),Object(r.jsx)(_.a,{}),F({onClick:function(e){return v({o:e})}})]})]})}var $=["today","yesterday","this_week","last_week"],Y=function(e){return e&&!isNaN(e.getDate())&&e.toISOString()||""};function q(e){var n,t=e.value,a=e.disabled,o=e.onChange,i=Object(l.a)({condition:t}),s=Object(u.a)(i,2),d=s[0],b=s[1],h=R(),g=d.condition,m=d.menuAnchor,v=function(e){b({condition:e,menuAnchor:null}),o(e)},O=function(e){var n=g.v||["","",""];return e.forEach((function(t,r){return e[r]=void 0===t?n[r]:t})),e},x=function(e){return v(Object(c.a)(Object(c.a)({},g),{},{v:O(e)}))},C=function(e,n){return v({o:e,v:O(n)})},k=$.map((function(e){return Object(r.jsx)(p.a,{onClick:(n=e,function(){return v({o:n})}),children:M[e]},"operator_".concat(e));var n}));return"default"===g.o?n=Object(r.jsx)(w.b,{value:g.v[0]||null,onChange:function(e){return x([Y(e),"",""])},disabled:a,placeholder:g.v[0]?null:"?",format:"yyyy/MM/dd HH:mm",variant:"inline"}):"between"===g.o&&(n=Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(w.b,{value:g.v[1]||null,onChange:function(e){return x(["",Y(e),void 0])},disabled:a,placeholder:g.v[1]?null:"-\u221e",format:"yyyy/MM/dd HH:mm",variant:"inline"}),Object(r.jsx)("span",{className:Object(y.default)(h.and,a&&h.disabled),children:"AND"}),Object(r.jsx)(w.b,{value:g.v[2]||null,onChange:function(e){return x(["",void 0,Y(e)])},disabled:a,placeholder:g.v[2]?null:"\u221e",format:"yyyy/MM/dd HH:mm",variant:"inline"})]})),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(j.a,{onClick:function(e){var n=e.target;return b({menuAnchor:n})},disabled:a,children:M[g.o]||"Is date"}),n,Object(r.jsxs)(f.a,{open:Boolean(m),anchorEl:m,onClose:function(){return b({menuAnchor:null})},children:[Object(r.jsx)(p.a,{onClick:function(){return C("default",[void 0,"",""])},children:"Date"}),Object(r.jsx)(p.a,{onClick:function(){return C("between",["",void 0,void 0])},children:"Between"}),k,Object(r.jsx)(_.a,{}),F({onClick:function(e){return v({o:e})}})]})]})}var G=Object(C.a)((function(e){return{selector:{padding:e.spacing(1),border:"solid 1px ".concat(e.palette.text.disabled),borderRadius:e.spacing(2),marginTop:e.spacing(1),marginLeft:e.spacing(1)}}}));function K(e){var n=e.property,t=e.value,a=e.onDelete,c=e.disabled,o=e.onChange,i=G(),u=!c&&Object(r.jsx)(v.a,{size:"small",onClick:a,disabled:c,children:Object(r.jsx)(x.a,{})}),l=function(e){switch(e.type){case"integer":case"number":return Z;case"boolean":return z;case"string":if(e.propertySchema.enum)return P;if("date"===e.propertySchema.format||"date-time"===e.propertySchema.format||"time"===e.propertySchema.format)return q;default:return J}}(n);return Object(r.jsxs)("div",{className:Object(y.default)("flex wrap align-items-center",i.selector),children:[u,Object(r.jsx)(m.a,{label:n.name}),Object(r.jsx)(l,{value:t,disabled:c,onChange:o,property:n},t[E.g])]})}var Q=Object(C.a)((function(e){return{selectors:{marginBottom:e.spacing(2)},error:{color:e.palette.error.main},skeleton:{padding:e.spacing(1),marginTop:e.spacing(1),marginLeft:e.spacing(1)}}}));n.default={title:"Data Event",icon:Object(r.jsx)(i,{}),actions:{index:{fields:["namespace","name","data_type","triggers","trigger_evaluator","updated_at"]},new:{fields:["namespace","name","data_type","triggers","trigger_evaluator"]}},fields:{data_type:{controlProps:{editDisabled:!0}},triggers:{control:function(e){e.title,e.property;var n=e.value,t=e.disabled,o=e.readOnly,i=e.onChange,h=e.errors,m=Object(l.a)({triggers:{}}),v=Object(u.a)(m,2),O=v[0],x=v[1],C=Object(a.useRef)(),_=Q(),k=V()(),A=O.props,w=O.menuAnchor,S=O.triggers,N=Object(a.useCallback)((function(e,t){x(Object(c.a)({triggers:e},t)),e=JSON.stringify(e),n.set(e),i(e)}),[n,i]);Object(a.useEffect)((function(){var e=n.changed().subscribe((function(e){e=(e=(e||"").trim())&&JSON.parse(e)||{},x({triggers:e})}));return n.changed().next(n.get()),function(){return e.unsubscribe()}}),[n]),Object(a.useEffect)((function(){var e=n.parent.changed().pipe(Object(s.a)((function(e){var t=e.data_type;return(null===t||void 0===t?void 0:t.id)!==C.current&&(C.current&&setTimeout((function(){n.set("{}",!0),x({triggers:{},props:null})})),C.current=null===t||void 0===t?void 0:t.id,C.current)?d.b.getById(C.current):Object(b.a)(null)})),Object(s.a)((function(e){return e&&e.simpleProperties()||Object(b.a)(null)}))).subscribe((function(e){!e&&C.current||x({props:e})}));return n.parent.changed().next(n.parent.get()),function(){return e.unsubscribe()}}),[n]);var B,M,D=function(e,n){return function(){var t=Object(c.a)({},S);t[e].splice(n,1),t[e].length||delete t[e],N(t)}},F=function(e,n){return function(t){var r=Object(c.a)({},S);t[E.g]=r[e][n][E.g],r[e][n]=t,N(r)}},T=function(e){return function(){var n=Object(c.a)({},S);n[e.name]||(n[e.name]=[]),n[e.name].push(function(e){switch(e.type){case"integer":case"number":return{o:"default",v:["","",""]};case"boolean":return{v:"true"};case"string":return e.propertySchema.enum?{}:"date"===e.propertySchema.format||"date-time"===e.propertySchema.format||"time"===e.propertySchema.format?{o:"_not_null"}:{o:"like"};default:return{}}}(e)),N(n,{menuAnchor:null})}};return A?(B=(A||[]).map((function(e){return Object(r.jsx)(p.a,{onClick:T(e),children:e.name},"prop_".concat(e.name))})),M=Object.keys(S).map((function(e){var n=(A||[]).find((function(n){return n.name===e}));if(n)return S[e].map((function(e,a){return e[E.g]||(e[E.g]=H.a.string()),Object(r.jsx)(K,{property:n,value:e,disabled:t||o,onDelete:D(n.name,a),onChange:F(n.name,a)},e[E.g])}))})).filter((function(e){return e})).flat()):M=Object.keys(S).map((function(e){return S[e]})).flat().map((function(e,n){return Object(r.jsx)(I.a,{variant:"text",height:k.spacing(4),width:k.spacing(22),className:_.skeleton},"skeleton_".concat(n))})),Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:Object(y.default)("flex wrap",_.selectors),children:M}),Object(r.jsx)(j.a,{className:Object(y.default)((null===h||void 0===h?void 0:h.length)&&_.error),startIcon:Object(r.jsx)(g.a,{}),disabled:t||o||!A,onClick:function(e){var n=e.target;return x({menuAnchor:n})},children:"Add trigger"}),Object(r.jsx)(f.a,{onClose:function(){return x({menuAnchor:null})},anchorEl:w,open:Boolean(w),children:B})]})}},trigger_evaluator:{selector:{parameters_size:{$gte:1,$lte:2}}}},dynamicConfig:function(e,n){var t=e.data_type,r=e.triggers,a=e.trigger_evaluator;if(t){if(r&&"{}"!==r){if(n.triggers||!n.trigger_evaluator)return{trigger_evaluator:{hidden:!0}}}else if(a){if(n.trigger_evaluator||!n.triggers)return{triggers:{hidden:!0}}}else if(n.triggers||n.trigger_evaluator)return{}}else if(!n.triggers||!n.trigger_evaluator)return{triggers:{hidden:!0},trigger_evaluator:{hidden:!0}}}}}}]);